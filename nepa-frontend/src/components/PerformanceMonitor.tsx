import React, { useEffect, useState, useRef } from 'react';\nimport { PerformanceMonitor, PerformanceMetrics } from '../utils/performance';\nimport { useTheme } from '../contexts/ThemeContext';\n\ninterface PerformanceMonitorProps {\n  enabled?: boolean;\n  showDetails?: boolean;\n  onMetricsUpdate?: (metrics: PerformanceMetrics) => void;\n}\n\nexport const PerformanceMonitorComponent: React.FC<PerformanceMonitorProps> = ({\n  enabled = true,\n  showDetails = false,\n  onMetricsUpdate,\n}) => {\n  const { resolvedTheme } = useTheme();\n  const [metrics, setMetrics] = useState<PerformanceMetrics | null>(null);\n  const [isVisible, setIsVisible] = useState(false);\n  const monitorRef = useRef<PerformanceMonitor | null>(null);\n  const intervalRef = useRef<NodeJS.Timeout | null>(null);\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    // Initialize performance monitor\n    monitorRef.current = new PerformanceMonitor();\n\n    // Update metrics every 5 seconds\n    const updateMetrics = () => {\n      if (monitorRef.current) {\n        const currentMetrics = monitorRef.current.getMetrics();\n        setMetrics(currentMetrics);\n        onMetricsUpdate?.(currentMetrics);\n      }\n    };\n\n    updateMetrics();\n    intervalRef.current = setInterval(updateMetrics, 5000);\n\n    return () => {\n      if (intervalRef.current) {\n        clearInterval(intervalRef.current);\n      }\n      if (monitorRef.current) {\n        monitorRef.current.cleanup();\n      }\n    };\n  }, [enabled, onMetricsUpdate]);\n\n  const getScoreColor = (value: number, threshold: number, inverse = false) => {\n    const ratio = inverse ? threshold / value : value / threshold;\n    if (ratio <= 1) return 'text-green-600';\n    if (ratio <= 1.5) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  const formatBytes = (bytes: number) => {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const formatTime = (ms: number) => {\n    if (ms < 1000) return `${ms.toFixed(0)}ms`;\n    return `${(ms / 1000).toFixed(2)}s`;\n  };\n\n  const getPerformanceGrade = (metrics: PerformanceMetrics) => {\n    let score = 100;\n    \n    // FCP: Target <1.8s\n    if (metrics.fcp > 1800) score -= 20;\n    \n    // LCP: Target <2.5s\n    if (metrics.lcp > 2500) score -= 20;\n    \n    // CLS: Target <0.1\n    if (metrics.cls > 0.1) score -= 20;\n    \n    // TTI: Target <3.8s\n    if (metrics.tti > 3800) score -= 20;\n    \n    // Bundle size: Target <1.5MB\n    if (metrics.bundleSize > 1.5 * 1024 * 1024) score -= 20;\n    \n    return Math.max(0, score);\n  };\n\n  if (!metrics) return null;\n\n  const grade = getPerformanceGrade(metrics);\n  const gradeColor = grade >= 90 ? 'text-green-600' : grade >= 70 ? 'text-yellow-600' : 'text-red-600';\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-50\">\n      {/* Performance Indicator */}\n      <button\n        onClick={() => setIsVisible(!isVisible)}\n        className={`p-3 rounded-full shadow-lg transition-all duration-300 ${\n          grade >= 90 ? 'bg-green-500' : grade >= 70 ? 'bg-yellow-500' : 'bg-red-500'\n        } text-white hover:scale-110`}\n        aria-label={`Performance score: ${grade}%`}\n      >\n        <span className=\"text-sm font-bold\">{grade}%</span>\n      </button>\n\n      {/* Detailed Metrics Panel */}\n      {isVisible && (\n        <div className={`absolute bottom-16 right-0 w-80 p-4 rounded-lg shadow-xl border ${\n          resolvedTheme === 'dark' \n            ? 'bg-gray-800 border-gray-700' \n            : 'bg-white border-gray-200'\n        }`}>\n          <div className=\"flex justify-between items-center mb-4\">\n            <h3 className=\"text-lg font-semibold\">Performance Metrics</h3>\n            <button\n              onClick={() => setIsVisible(false)}\n              className=\"text-gray-500 hover:text-gray-700\"\n              aria-label=\"Close performance panel\"\n            >\n              ✕\n            </button>\n          </div>\n\n          {/* Overall Score */}\n          <div className=\"mb-4 p-3 rounded bg-gray-50 dark:bg-gray-700\">\n            <div className=\"flex justify-between items-center\">\n              <span className=\"font-medium\">Overall Score</span>\n              <span className={`text-2xl font-bold ${gradeColor}`}>{grade}%</span>\n            </div>\n          </div>\n\n          {/* Core Web Vitals */}\n          {showDetails && (\n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">FCP</span>\n                <span className={`text-sm font-medium ${getScoreColor(metrics.fcp, 1800)}`}>\n                  {formatTime(metrics.fcp)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">LCP</span>\n                <span className={`text-sm font-medium ${getScoreColor(metrics.lcp, 2500)}`}>\n                  {formatTime(metrics.lcp)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">CLS</span>\n                <span className={`text-sm font-medium ${getScoreColor(metrics.cls, 0.1)}`}>\n                  {metrics.cls.toFixed(3)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">TTI</span>\n                <span className={`text-sm font-medium ${getScoreColor(metrics.tti, 3800)}`}>\n                  {formatTime(metrics.tti)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">Bundle Size</span>\n                <span className={`text-sm font-medium ${getScoreColor(metrics.bundleSize, 1.5 * 1024 * 1024, true)}`}>\n                  {formatBytes(metrics.bundleSize)}\n                </span>\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-sm text-gray-600 dark:text-gray-400\">Memory Usage</span>\n                <span className={`text-sm font-medium ${getScoreColor(metrics.memoryUsage, 50 * 1024 * 1024, true)}`}>\n                  {formatBytes(metrics.memoryUsage)}\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Recommendations */}\n          {grade < 90 && (\n            <div className=\"mt-4 p-3 rounded bg-yellow-50 dark:bg-yellow-900/20\">\n              <h4 className=\"text-sm font-semibold text-yellow-800 dark:text-yellow-200 mb-2\">\n                Recommendations\n              </h4>\n              <ul className=\"text-xs text-yellow-700 dark:text-yellow-300 space-y-1\">\n                {metrics.fcp > 1800 && (\n                  <li>• Optimize initial CSS and remove render-blocking resources</li>\n                )}\n                {metrics.lcp > 2500 && (\n                  <li>• Compress images and implement lazy loading</li>\n                )}\n                {metrics.cls > 0.1 && (\n                  <li>• Include size attributes for images and videos</li>\n                )}\n                {metrics.tti > 3800 && (\n                  <li>• Reduce JavaScript execution time and implement code splitting</li>\n                )}\n                {metrics.bundleSize > 1.5 * 1024 * 1024 && (\n                  <li>• Implement tree shaking and dynamic imports</li>\n                )}\n              </ul>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n};
